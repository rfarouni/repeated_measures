blacklist <-  c(dac_grange, duke_grange, gaps_grange)
blacklist <- reduce(blacklist)
blacklist
as.data.frame(blacklist)
as.data.frame(blacklist)[,1:3]
blacklist
file.path(dirpath, "blacklist.bed")
dirpath <- "/hd2/DeepChrome/genome_data/annotation/Exclude"
fwrite(blacklist, file.path(dirpath, "blacklist.bed"), col.names = FALSE)
blacklist <- as.data.frame(blacklist)[,1:3]
fwrite(blacklist, file.path(dirpath, "blacklist.bed"), col.names = FALSE)
fwrite(blacklist, file.path(dirpath, "blacklist.bed"), col.names = FALSE, sep = "\t")
library(data.table)
library(GenomicRanges)
dirpath <- "/hd2/DeepChrome/genome_data/annotation/Exclude"
dac  <- fread(file.path(dirpath,"consensusBlacklist.bed"),
sep = "\t")
duke <- fread(file.path(dirpath,"dukeExcludeRegions.bed"),
sep = "\t")
gaps <- fread(file.path(dirpath, "gap.txt"),
sep = "\t")
dac_grange <- GRanges(seqnames = dac$V1,
ranges   = IRanges(start = dac$V2,
end = dac$V3))
duke_grange <- GRanges(seqnames = duke$V1,
ranges   = IRanges(start = duke$V2,
end = duke$V3))
gaps_grange <- GRanges(seqnames = gaps$V2,
ranges   = IRanges(start = gaps$V3,
end = gaps$V4))
chromosomes <- c('chr1','chr2','chr3','chr4','chr5',
'chr6','chr7','chr8','chr9','chr10',
'chr11','chr12','chr13','chr14','chr15',
'chr16','chr17','chr18','chr19',
'chr20','chr21','chr22','chrX')
dac_grange <- keepSeqlevels(dac_grange, chromosomes)
duke_grange <- keepSeqlevels(duke_grange, chromosomes)
gaps_grange <- keepSeqlevels(gaps_grange, chromosomes)
blacklist <-  c(dac_grange, duke_grange, gaps_grange)
blacklist <- reduce(blacklist)
blacklist <- as.data.frame(blacklist)[,1:3]
fwrite(blacklist,
file.path(dirpath, "blacklist.bed"),
col.names = FALSE, sep = "\t")
gaps_filepath <- file.path(dirpath, "gap.txt")
gaps_filepath
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/gap.txt.gz",
gaps_filepath)
gaps_filepath <- file.path(dirpath, "gap.txt.gz")
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/gap.txt.gz",
gaps_filepath)
>fread
?fread
gaps <- fread(gaps_filepath, sep = "\t")
sprintf("gzip %s", gaps_filepath)
sprintf("zcat %s", gaps_filepath)
system(sprintf("zcat %s", gaps_filepath))
getwd()
)
sprintf("zcat < %s", gaps_filepath
system( sprintf("zcat < %s", gaps_filepath))
sprintf("zcat < %s", gaps_filepath)
system( sprintf("zcat < %s", gaps_filepath))
gaps <- fread(input = sprintf("zcat < %s", gaps_filepath), sep = "\t")
View(gaps)
dac_filepath <- file.path(dirpath,"consensusBlacklist.bed")
duke_filepath <- file.path(dirpath,"dukeExcludeRegions.bed")
gaps_filepath <- file.path(dirpath, "gap.txt.gz")
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/gap.txt.gz",
gaps_filepath)
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeMapability/wgEncodeDacMapabilityConsensusExcludable.bed.gz",
dac_filepath)
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeMapability/wgEncodeDukeMapabilityRegionsExcludable.bed.gz",
duke_filepath)
dac_filepath <- file.path(dirpath,"consensusBlacklist.bed.gz")
duke_filepath <- file.path(dirpath,"dukeExcludeRegions.bed.gz")
gaps_filepath <- file.path(dirpath, "gap.txt.gz")
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/gap.txt.gz",
gaps_filepath)
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeMapability/wgEncodeDacMapabilityConsensusExcludable.bed.gz",
dac_filepath)
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeMapability/wgEncodeDukeMapabilityRegionsExcludable.bed.gz",
duke_filepath)
dac  <- fread(input = sprintf("zcat < %s", dac_filepath), sep = "\t")
duke <- fread(input = sprintf("zcat < %s", duke_filepath), sep = "\t")
gaps <- fread(input = sprintf("zcat < %s", gaps_filepath), sep = "\t")
dac_grange <- GRanges(seqnames = dac$V1,
ranges   = IRanges(start = dac$V2,
end = dac$V3))
duke_grange <- GRanges(seqnames = duke$V1,
ranges   = IRanges(start = duke$V2,
end = duke$V3))
gaps_grange <- GRanges(seqnames = gaps$V2,
ranges   = IRanges(start = gaps$V3,
end = gaps$V4))
chromosomes <- c('chr1','chr2','chr3','chr4','chr5',
'chr6','chr7','chr8','chr9','chr10',
'chr11','chr12','chr13','chr14','chr15',
'chr16','chr17','chr18','chr19',
'chr20','chr21','chr22','chrX')
dac_grange <- keepSeqlevels(dac_grange, chromosomes)
duke_grange <- keepSeqlevels(duke_grange, chromosomes)
gaps_grange <- keepSeqlevels(gaps_grange, chromosomes)
blacklist <-  c(dac_grange, duke_grange, gaps_grange)
blacklist <- reduce(blacklist)
blacklist
blacklist <- as.data.frame(blacklist)[,1:3]
fwrite(blacklist,
file.path(dirpath, "blacklist.bed"),
col.names = FALSE, sep = "\t")
download.file("http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/
wgEncodeMapability/wgEncodeDacMapabilityConsensusExcludable.bed.gz",
dac_filepath)
19817+15787+7568+14636
1,900*11
1900*11
19900/12
library("data.table")
library("lme4")
library("dplyr")
library("ggplot2")
NLSY_wide <- fread("NLSY.txt", na.strings = ".")
NLSL_wide
setwd("~/Documents/repos/repeated_measures/assets/assignments/chap4")
NLSY_wide <- fread("NLSY.txt", na.strings = ".")
NLSL_wide
NLSY_wide <- fread("NLSY.txt", na.strings = ".")
NLSY_wide
NLSY_long <- NLSY_wide %>%
reshape(direction = "long",
idvar = c("id"),
varying = list(c(2:5), c(10:13), c(14:17)),
v.names = c("read_score", "mother_age", "child_age"),
times = c("1", "2", "3", "4")) %>%
na.omit()
NLSY_wide <- NLSY_wide %>%
mutate(m_age1 = m_age,
m_age2 = m_age + 2,
m_age3 = m_age + 4,
m_age4 = m_age + 6,
c_age1 = age,
c_age2 = age + 2,
c_age3 = age + 4,
c_age4 = age + 6) %>%
select(-c(m_age, age))
NLSY_wide <- NLSY_wide %>%
mutate(m_age1 = m_age,
m_age2 = m_age + 2,
m_age3 = m_age + 4,
m_age4 = m_age + 6,
c_age1 = age,
c_age2 = age + 2,
c_age3 = age + 4,
c_age4 = age + 6) %>%
select(-c(m_age, age))
View(NLSY_wide)
NLSY_wide <- fread("NLSY.txt", na.strings = ".")
NLSY_wide
NLSY_wide <- NLSY_wide %>%
mutate(m_age1 = m_age,
m_age2 = m_age + 2,
m_age3 = m_age + 4,
m_age4 = m_age + 6,
c_age1 = age,
c_age2 = age + 2,
c_age3 = age + 4,
c_age4 = age + 6) %>%
select(-c(m_age, age))
NLSY_wide
NLSY_long <- NLSY_wide %>%
reshape(direction = "long",
idvar = c("id"),
varying = list(c(2:5), c(10:13), c(14:17)),
v.names = c("read_score", "mother_age", "child_age"),
times = c("1", "2", "3", "4")) %>%
na.omit()
NLSY_long <- NLSY_wide %>%
reshape(direction = "long",
idvar = c("id"),
varying = list(c(2:5), c(10:13), c(14:17)),
v.names = c("read_score", "mother_age", "child_age"),
times = c("1", "2", "3", "4")) %>%
na.omit()
NLSY_long
ggplot(data = df_long, aes(x = week , y = score, group = id)) +
geom_line(aes(colour = id), size = 0.2) +
facet_grid(. ~ group) +
xlab("Weeks") +
ylab("Rating") +
ggtitle(" Hamilton Depression Rating Scale scores")
NLSY_long <- within(NLSY_long, {
id <- factor(id)
boy <- factor(boy)
time <- factor(time)
mother_age <- mother_age - 6
child_age <- child_age - 6
})
temp_df <- NLSY_long %>% filter(id %in% NLSL_long$id[1:36])
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:36])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 6) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:40])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 8) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:40])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 10) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:48])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 12) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:60])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 15) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:60])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 12) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:60])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 10) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:50])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 10) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSL Data") +
theme(legend.position = "none")
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:50])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 10) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSY Data") +
theme(legend.position = "none")
NLSY_fit <- lmer( read_score ~ child_age + I(child_age^2) + (1 + child_age + I(child_age^2)|id),
data = NLSY_long)
summary(NLSY_fit)
<- lmer( read_score ~ child_age + I(child_age^2) + (1 + child_age + I(child_age^2)|id),
NLSY_fit
NLSY_fit <- lmer( read_score ~ child_age + I(child_age^2) + (1 + child_age + I(child_age^2)|id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit)
NLSY_fit <- lmer( read_score ~ child_age + I(child_age^2) + (0 + child_age + I(child_age^2)|id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit)
NLSY_orth_fit <- lmer( read_score ~ child_age + poly(child_age, 2) + (0 + child_age + poly(child_age, 2)|id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit)
poly(x,2)
poly(child_age, 2)
poly(NLSY_long$child_age, 2)
NLSY_orth_fit <- lmer( read_score ~ poly(child_age, 2) + (0 + poly(child_age, 2)|id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_orth_fit)
plot(NLSY_fit)
cov.m1 <- getVarCov(NLSY_fit, type = "marginal")
(vc <- VarCorr(NLSY_fit))
(vc <- VarCorr(NLSY_fit))
print(vc,comp=c("Variance","Std.Dev."),digits=2)
(vc <- VarCorr(NLSY_fit))
print(vc,comp=c("Variance"))
as.data.frame(vc)
as.data.frame(vc,order="lower.tri")
(vc <- VarCorr(NLSY_fit))
print(vc, comp = c("Variance"))
as.data.frame(vc,
order = "lower.tri")
(vc <- VarCorr(NLSY_fit))
print(vc, comp = c("Variance"))
plot(ranef(NLSY_fit ))
plot(ranef(NLSY_fit ))
library("lattice")
plot(ranef(NLSY_fit ))
fm1W <- confint(NLSY_fit, method="profile")
pp <- profile(NLSY_fit)
xyplot(pp, aspect = 1.3,absVal = TRUE)
dotplot(ranef(NLSY_fit, condVar = TRUE))
ranef(NLSY_fit, condVar = TRUE)
dotplot(ranef(NLSY_fit, condVar = TRUE))
?dotplot
(ranef_betas <- ranef(NLSY_fit, condVar = TRUE))
dotplot(ranef_betas)
(ranef_betas <- as.data.frame(ranef(NLSY_fit, condVar = TRUE)))
(ranef_betas <- data.frame(ranef(NLSY_fit, condVar = TRUE)))
(ranef_betas <- ranef(NLSY_fit, condVar = TRUE))
dotplot(ranef_betas)
(ranef_betas <- ranef(NLSY_fit, condVar = TRUE)$id)
dotplot(ranef_betas)
ranef_betas <- ranef(NLSY_fit, condVar = TRUE)
(ranef_betas$id)
dotplot(ranef_betas)
ranef_betas <- ranef(NLSY_fit, condVar = TRUE)
dotplot(ranef_betas)
(ranef_betas$id)
(ranef_betas <- ranef(NLSY_fit, condVar = TRUE))
dotplot(ranef_betas)
qqmath(ranef(NLSY_fit, condVar=TRUE))
ggCaterpillar <- function(re, QQ=TRUE, likeDotplot=TRUE) {
require(ggplot2)
f <- function(x) {
pv   <- attr(x, "postVar")
cols <- 1:(dim(pv)[1])
se   <- unlist(lapply(cols, function(i) sqrt(pv[i, i, ])))
ord  <- unlist(lapply(x, order)) + rep((0:(ncol(x) - 1)) * nrow(x), each=nrow(x))
pDf  <- data.frame(y=unlist(x)[ord],
ci=1.96*se[ord],
nQQ=rep(qnorm(ppoints(nrow(x))), ncol(x)),
ID=factor(rep(rownames(x), ncol(x))[ord], levels=rownames(x)[ord]),
ind=gl(ncol(x), nrow(x), labels=names(x)))
if(QQ) {  ## normal QQ-plot
p <- ggplot(pDf, aes(nQQ, y))
p <- p + facet_wrap(~ ind, scales="free")
p <- p + xlab("Standard normal quantiles") + ylab("Random effect quantiles")
} else {  ## caterpillar dotplot
p <- ggplot(pDf, aes(ID, y)) + coord_flip()
if(likeDotplot) {  ## imitate dotplot() -> same scales for random effects
p <- p + facet_wrap(~ ind)
} else {           ## different scales for random effects
p <- p + facet_grid(ind ~ ., scales="free_y")
}
p <- p + xlab("Levels") + ylab("Random effects")
}
p <- p + theme(legend.position="none")
p <- p + geom_hline(yintercept=0)
p <- p + geom_errorbar(aes(ymin=y-ci, ymax=y+ci), width=0, colour="black")
p <- p + geom_point(aes(size=1.2), colour="blue")
return(p)
}
lapply(re, f)
}
ggCaterpillar(ranef(fit, condVar=TRUE))
ggCaterpillar(ranef_betas)
plot(NLSY_fit)
NLSY_fit2 <- lmer( read_score ~ child_age + I(child_age^2) + (0 + child_age + I(child_age^2)||id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit2)
anova(NLSY_fit2,NLSY_fit)
NLSY_fit2 <- lmer( read_score ~ child_age + I(child_age^2) + (1 + child_age + I(child_age^2)||id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit2)
anova(NLSY_fit2,NLSY_fit)
plot(NLSY_fit1)
NLSY_fit1 <- lmer( read_score ~ child_age + I(child_age^2) + (0 + child_age + I(child_age^2)|id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit1)
NLSY_fit2 <- lmer( read_score ~ child_age + I(child_age^2) + (0 + child_age + I(child_age^2)||id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit2)
anova(NLSY_fit2, NLSY_fit1)
(vc <- VarCorr(NLSY_fit1))
print(vc, comp = c("Variance"))
plot(NLSY_fit1)
?qqmath
ranef_betas <- ranef(NLSY_fit1, condVar = TRUE)
dotplot(ranef_betas)
NLSY_wide <- fread("NLSY.txt", na.strings = ".")
NLSY_wide
NLSY_wide <- NLSY_wide %>%
mutate(c_age1 = age,
c_age2 = age + 2,
c_age3 = age + 4,
c_age4 = age + 6) %>%
select(- age)
NLSY_wide
NLSY_wide <- NLSY_wide %>%
mutate(m_age1 = m_age,
m_age2 = m_age + 2,
m_age3 = m_age + 4,
m_age4 = m_age + 6,
c_age1 = age,
c_age2 = age + 2,
c_age3 = age + 4,
c_age4 = age + 6) %>%
select(-c(m_age, age))
library("data.table")
library("lme4")
library("dplyr")
library("ggplot2")
library("lattice")
library("data.table")
library("lme4")
library("dplyr")
library("ggplot2")
library("lattice")
NLSY_wide <- fread("NLSY.txt", na.strings = ".")
NLSY_wide
NLSY_wide <- NLSY_wide %>%
mutate(m_age1 = m_age,
m_age2 = m_age + 2,
m_age3 = m_age + 4,
m_age4 = m_age + 6,
c_age1 = age,
c_age2 = age + 2,
c_age3 = age + 4,
c_age4 = age + 6) %>%
select(-c(m_age, age))
NLSY_wide
NLSY_long <- NLSY_wide %>%
reshape(direction = "long",
idvar = c("id"),
varying = list(c(2:5), c(10:13), c(14:17)),
v.names = c("read_score", "mother_age", "child_age"),
times = c("1", "2", "3", "4")) %>%
na.omit()
NLSY_long
NLSY_long <- within(NLSY_long, {
id <- factor(id)
boy <- factor(boy)
time <- factor(time)
mother_age <- mother_age - 6
child_age <- child_age - 6
})
temp_df <- NLSY_long %>% filter(id %in% NLSY_long$id[1:50])
ggplot(data = temp_df ,
aes(x = child_age ,
y = read_score,
group = boy)) +
facet_wrap( ~ id, ncol = 10) +
geom_line(aes(colour = boy), size = 0.2) +
xlab("Age") +
ylab("Reading Score") +
ggtitle("NLSY Data") +
theme(legend.position = "none")
NLSY_fit1 <- lmer( read_score ~ child_age + I(child_age^2) + (0 + child_age + I(child_age^2)|id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit1)
NLSY_fit2 <- lmer( read_score ~ child_age + I(child_age^2) + (0 + child_age + I(child_age^2)||id),
data = NLSY_long,
REML = FALSE)
summary(NLSY_fit2)
anova(NLSY_fit2, NLSY_fit1)
(vc <- VarCorr(NLSY_fit1))
print(vc, comp = c("Variance"))
plot(NLSY_fit1)
ranef_betas <- ranef(NLSY_fit1, condVar = TRUE)
dotplot(ranef_betas)
qqmath(ranef_betas)
(vc <- vcov(NLSY_fit1))
(vc <- VarCorr(NLSY_fit1))
print(vc, comp = c("Variance"))
